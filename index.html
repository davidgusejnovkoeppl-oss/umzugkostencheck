<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>umzugkostencheck.de – Umzugskosten vergleichen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      /* BRAND (wie Backend) */
      --brand:#0050b3;
      --brand-dark:#003f8f;

      --blue-50:#eff6ff;
      --blue-100:#dbeafe;
      --blue-400:#60a5fa;

      --gray-50:#f9fafb;
      --gray-100:#f3f4f6;
      --gray-200:#e5e7eb;
      --gray-300:#d1d5db;
      --gray-400:#9ca3af;
      --gray-500:#6b7280;
      --gray-700:#374151;

      --green-500:#22c55e;
      --green-600:#16a34a;
      --purple-500:#a855f7;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:linear-gradient(135deg,#e0f2fe,#eef2ff);
      color:#111827;
    }
    .page{min-height:100vh;display:flex;flex-direction:column;}
    .hero{
      background:linear-gradient(135deg,var(--brand),var(--brand-dark));
      color:#fff;
      padding:2.5rem 1.25rem 6rem;
    }
    .container{width:100%;max-width:1120px;margin:0 auto;text-align:center;}
    .badge{
      display:inline-flex;align-items:center;gap:0.5rem;
      padding:0.25rem 0.85rem;border-radius:999px;
      background:rgba(255,255,255,0.1);
      border:1px solid rgba(255,255,255,0.25);
      font-size:0.8rem;
    }
    .hero-title{font-size:2.3rem;line-height:1.1;font-weight:700;margin:1rem auto 0.5rem;}
    .hero-subtitle{font-size:1.1rem;opacity:0.95;max-width:32rem;margin:0 auto;}
    .trust-row{
      margin-top:1.75rem;display:flex;flex-wrap:wrap;gap:0.75rem;justify-content:center;
    }
    .trust-item{
      flex:1 1 160px;max-width:220px;
      background:rgba(15,23,42,0.25);
      border-radius:0.9rem;padding:0.65rem 0.9rem;font-size:0.85rem;
      display:flex;align-items:center;gap:0.5rem;justify-content:center;white-space:nowrap;
    }
    .trust-dot{width:8px;height:8px;border-radius:999px;background:#bfdbfe;flex-shrink:0;}

    .card{
      width:100%;max-width:1120px;margin:-4rem auto 3rem;background:#fff;
      border-radius:1.5rem;box-shadow:0 20px 45px rgba(15,23,42,0.2);
      padding:1.8rem 1.5rem 2.2rem;
    }
    @media (min-width:768px){
      .card{padding:2.4rem 2.6rem 2.8rem;}
      .hero-title{font-size:2.7rem;}
    }

    /* Step indicator */
    .steps{display:flex;justify-content:space-between;gap:0.75rem;margin-bottom:2rem;max-width:640px;margin-inline:auto;}
    .step-item{display:flex;flex-direction:column;align-items:center;flex:1;position:relative;}
    .step-circle{
      width:44px;height:44px;border-radius:999px;display:flex;align-items:center;justify-content:center;
      background:var(--gray-100);border:2px solid var(--gray-200);color:var(--gray-400);
      font-weight:600;font-size:0.95rem;transition:all .2s ease;z-index:1;
    }
    .step-label{margin-top:0.45rem;font-size:0.8rem;color:var(--gray-500);font-weight:500;}
    .step-item.current .step-circle{
      background:linear-gradient(135deg,var(--brand),var(--brand-dark));
      border-color:transparent;color:#fff;box-shadow:0 0 0 4px rgba(0,80,179,0.25);transform:scale(1.05);
    }
    .step-item.completed .step-circle{
      background:linear-gradient(135deg,var(--green-500),var(--green-600));
      border-color:transparent;color:#fff;box-shadow:0 0 0 4px rgba(34,197,94,0.35);
    }
    .step-item.completed .step-circle::before{content:"✓";font-weight:700;}
    .step-item.completed .step-circle span{display:none;}
    .step-item.current .step-label{color:var(--brand-dark);}
    .step-item.completed .step-label{color:var(--green-600);}
    .step-line{position:absolute;top:22px;left:50%;right:-50%;height:3px;background:var(--gray-200);z-index:0;}
    .step-item.completed .step-line{background:linear-gradient(90deg,var(--green-500),var(--green-600));}

    /* Form layout */
    .form-step{display:none;}
    .form-step.active{display:block;}

    h2.step-title{text-align:center;font-size:1.35rem;margin:0 0 0.35rem;font-weight:700;color:#111827;}
    .step-subtitle{text-align:center;font-size:0.95rem;color:var(--gray-500);margin-bottom:1.6rem;}

    label{display:block;font-size:0.8rem;font-weight:500;margin-bottom:0.25rem;color:#4b5563;}
    input,select,textarea{
      width:100%;border-radius:0.75rem;border:1px solid var(--gray-200);
      padding:0.55rem 0.75rem;font-size:0.9rem;outline:none;transition:border-color .15s,box-shadow .15s;
      font-family:inherit;
    }
    input:focus,select:focus,textarea:focus{border-color:var(--brand);box-shadow:0 0 0 1px rgba(0,80,179,0.25);}
    textarea{min-height:90px;resize:vertical;border-radius:0.9rem;}
    .grid-2{display:grid;grid-template-columns:1fr;gap:1rem;}
    @media(min-width:768px){.grid-2{grid-template-columns:repeat(2,minmax(0,1fr));}}
    .pill-card{
      padding:1.1rem 1.15rem;border-radius:1.2rem;border:1px solid var(--gray-200);
      background:linear-gradient(135deg,var(--gray-50),#fff);
    }
    input[type="checkbox"]{width:18px;height:18px;margin:0;accent-color:var(--brand);}

    /* Choice cards */
    .choice-grid{display:grid;grid-template-columns:1fr;gap:0.75rem;margin-bottom:1.25rem;}
    .choice-card{
      border-radius:1.1rem;border:1px solid var(--gray-200);padding:0.75rem 0.95rem;
      display:flex;flex-direction:column;justify-content:center;cursor:pointer;background:#fff;
      transition:border-color .15s,box-shadow .15s,background .15s,transform .1s;
    }
    .choice-card:hover{border-color:var(--blue-400);box-shadow:0 6px 20px rgba(15,23,42,0.08);transform:translateY(-1px);}
    .choice-card.selected{
      border-color:var(--brand);
      background:linear-gradient(135deg,var(--blue-50),#fff);
      box-shadow:0 8px 24px rgba(0,80,179,0.15);
    }
    .choice-title{font-size:0.95rem;font-weight:600;margin-bottom:0.15rem;}
    .choice-sub{font-size:0.8rem;color:var(--gray-500);}
    @media(min-width:768px){
      .choice-grid-2{grid-template-columns:repeat(2,minmax(0,1fr));}
      .choice-grid-3{grid-template-columns:repeat(3,minmax(0,1fr));}
    }

    /* Matching */
    .matching-circle{
      width:120px;height:120px;border-radius:999px;background:radial-gradient(circle at center,#22c55e,#16a34a);
      display:flex;align-items:center;justify-content:center;margin:1.5rem auto 1.2rem;
      box-shadow:0 12px 40px rgba(34,197,94,0.35);position:relative;
    }
    .matching-circle::before{
      content:"";position:absolute;inset:-18px;border-radius:999px;background:radial-gradient(circle at center,rgba(34,197,94,0.12),transparent);
    }
    .matching-circle span{font-size:2.2rem;color:#fff;}
    .matching-stats{display:grid;grid-template-columns:1fr;gap:0.75rem;margin-top:1.4rem;}
    .matching-card{border-radius:1.1rem;padding:0.9rem;text-align:center;background:var(--blue-50);}
    .matching-card:nth-child(2){background:#ecfdf5;}
    .matching-card:nth-child(3){background:#f5f3ff;}
    .matching-num{font-size:1.2rem;font-weight:700;color:var(--brand-dark);}
    .matching-label{font-size:0.8rem;color:var(--gray-500);}
    .matching-hint{margin-top:1.2rem;text-align:center;font-size:0.85rem;color:var(--gray-500);}
    @media(min-width:768px){.matching-stats{grid-template-columns:repeat(3,minmax(0,1fr));}}

    .matching-loading{text-align:center;padding:1.5rem 0 0.5rem;color:var(--gray-600);font-size:0.95rem;}
    .spinner{
      width:40px;height:40px;border-radius:999px;border:4px solid var(--blue-100);
      border-top-color:var(--brand);margin:0.5rem auto 0.75rem;animation:spin 1s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg);}}

    /* Nav */
    .nav-row{display:flex;justify-content:space-between;align-items:center;gap:0.75rem;margin-top:1.8rem;padding-top:1.2rem;border-top:1px solid var(--gray-100);}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:0.35rem;border-radius:999px;
      padding:0.6rem 1.4rem;border:1px solid transparent;font-size:0.9rem;font-weight:500;cursor:pointer;background:#fff;color:#111827;
    }
    .btn-outline{border-color:var(--gray-300);background:#fff;}
    .btn-primary{
      background:linear-gradient(135deg,var(--brand),var(--brand-dark));
      color:#fff;box-shadow:0 12px 30px rgba(0,80,179,0.25);
    }
    .btn-primary:disabled{opacity:0.5;cursor:not-allowed;box-shadow:none;}
    .btn-outline:disabled{opacity:0.5;cursor:not-allowed;}

    .error{color:var(--gray-500);font-size:0.8rem;margin-top:0.15rem;}
    .hint{font-size:0.85rem;color:var(--gray-500);}

    /* Email verification hint: kürzer */
    .email-verify-box{
      margin-top:0.55rem;
      border-radius:0.9rem;
      border:1px solid rgba(0,80,179,0.22);
      background:rgba(0,80,179,0.06);
      padding:0.55rem 0.7rem;
      font-size:0.82rem;
      color:#1f2937;
      line-height:1.35;
    }
    .email-verify-box strong{color:var(--brand-dark);}

    .success-message{text-align:center;padding:2.4rem 1rem 2.6rem;}
    .success-message h2{font-size:1.5rem;margin-bottom:0.75rem;}
    .success-circle{
      width:80px;height:80px;border-radius:999px;background:radial-gradient(circle at center,#22c55e,#16a34a);
      display:flex;align-items:center;justify-content:center;margin:0 auto 1.2rem;
      box-shadow:0 16px 40px rgba(34,197,94,0.45);
    }
    .success-circle span{color:#fff;font-size:2rem;font-weight:700;}

    .site-footer{margin-top:auto;padding:1rem 1.25rem 1.5rem;font-size:0.8rem;color:var(--gray-500);}
    .site-footer .container{text-align:center;}
    .site-footer a{color:inherit;text-decoration:none;margin:0 0.5rem;}
    .site-footer a:hover{text-decoration:underline;}
  </style>
</head>
<body>
<div class="page">
  <header class="hero">
    <div class="container">
      <div class="badge">Kostenlose &amp; unverbindliche Umzugsanfrage</div>
      <h1 class="hero-title">Umzugskosten vergleichen</h1>
      <p class="hero-subtitle">
        In wenigen Schritten kostenlos und unverbindlich Angebote von qualifizierten Umzugsunternehmen erhalten.
      </p>

      <div class="trust-row">
        <div class="trust-item"><div class="trust-dot"></div><span>Deutschlandweit</span></div>
        <div class="trust-item"><div class="trust-dot"></div><span>Qualifizierte Unternehmen</span></div>
        <div class="trust-item"><div class="trust-dot"></div><span>100% kostenlos</span></div>
      </div>
    </div>
  </header>

  <main class="card">
    <div class="steps" id="stepIndicator">
      <div class="step-item current" data-step="1"><div class="step-circle"><span>1</span></div><div class="step-label">Route</div><div class="step-line"></div></div>
      <div class="step-item" data-step="2"><div class="step-circle"><span>2</span></div><div class="step-label">Wohnung</div><div class="step-line"></div></div>
      <div class="step-item" data-step="3"><div class="step-circle"><span>3</span></div><div class="step-label">Details</div><div class="step-line"></div></div>
      <div class="step-item" data-step="4"><div class="step-circle"><span>4</span></div><div class="step-label">Matching</div><div class="step-line"></div></div>
      <div class="step-item" data-step="5"><div class="step-circle"><span>5</span></div><div class="step-label">Kontakt</div></div>
    </div>

    <!-- STEP 1 -->
    <div class="form-step active" data-step="1">
      <h2 class="step-title">Von wo nach wo ziehen Sie?</h2>
      <p class="step-subtitle">Geben Sie Ihre Umzugsroute an.</p>

      <div class="grid-2">
        <div class="pill-card">
          <h3 style="margin:0 0 0.7rem;font-size:0.95rem;font-weight:600;display:flex;align-items:center;gap:0.4rem;">
            <span style="width:8px;height:8px;border-radius:999px;background:#ef4444;"></span>
            Wohnung Auszug
          </h3>
          <div style="margin-bottom:0.6rem;">
            <label for="move_from_zip">Postleitzahl*</label>
            <input id="move_from_zip" type="text" inputmode="numeric" maxlength="5" />
            <div class="error" id="err_from_zip"></div>
          </div>
          <div>
            <label for="move_from_city">Stadt (optional)</label>
            <input id="move_from_city" type="text" />
          </div>
        </div>

        <div class="pill-card">
          <h3 style="margin:0 0 0.7rem;font-size:0.95rem;font-weight:600;display:flex;align-items:center;gap:0.4rem;">
            <span style="width:8px;height:8px;border-radius:999px;background:#22c55e;"></span>
            Wohnung Einzug
          </h3>
          <div style="margin-bottom:0.6rem;">
            <label for="move_to_zip">Postleitzahl*</label>
            <input id="move_to_zip" type="text" inputmode="numeric" maxlength="5" />
            <div class="error" id="err_to_zip"></div>
          </div>
          <div>
            <label for="move_to_city">Stadt (optional)</label>
            <input id="move_to_city" type="text" />
          </div>
        </div>
      </div>
    </div>

    <!-- STEP 2 -->
    <div class="form-step" data-step="2">
      <h2 class="step-title">Details zu den Wohnungen</h2>
      <p class="step-subtitle">Diese Angaben sind freiwillig – helfen aber, den Aufwand besser einzuschätzen.</p>

      <div class="grid-2">
        <div class="pill-card">
          <h3 style="margin:0 0 0.75rem;font-size:0.95rem;font-weight:600;display:flex;align-items:center;gap:0.4rem;">
            <span style="width:8px;height:8px;border-radius:999px;background:#ef4444;"></span>
            Wohnung Auszug
          </h3>

          <div style="margin-bottom:0.65rem;">
            <label for="living_space_from">Wohnfläche (m²)</label>
            <input id="living_space_from" type="number" inputmode="numeric" min="0" />
          </div>
          <div style="margin-bottom:0.65rem;">
            <label for="rooms_from">Anzahl Zimmer</label>
            <input id="rooms_from" type="number" inputmode="numeric" min="0" step="1" />
          </div>
          <div style="margin-bottom:0.8rem;">
            <label for="floor_from">Etage</label>
            <select id="floor_from">
              <option value="">Bitte wählen</option>
              <option value="-1">-1</option>
              <option value="0">EG</option>
              <option value="1">1. OG</option>
              <option value="2">2. OG</option>
              <option value="3">3. OG</option>
              <option value="4">4. OG</option>
              <option value="5">5. OG</option>
              <option value="6">6. OG</option>
              <option value="7">7. OG</option>
              <option value="8">8. OG</option>
              <option value="9">9. OG</option>
              <option value="10">10. OG</option>
              <option value="egal">Egal</option>
            </select>
          </div>

          <div style="display:flex;align-items:center;justify-content:flex-start;gap:0.55rem;">
            <input type="checkbox" id="has_elevator_from" />
            <label for="has_elevator_from" style="margin:0;font-size:0.88rem;cursor:pointer;">Aufzug vorhanden</label>
          </div>
        </div>

        <div class="pill-card">
          <h3 style="margin:0 0 0.75rem;font-size:0.95rem;font-weight:600;display:flex;align-items:center;gap:0.4rem;">
            <span style="width:8px;height:8px;border-radius:999px;background:#22c55e;"></span>
            Wohnung Einzug
          </h3>

          <div style="margin-bottom:0.65rem;">
            <label for="living_space_to">Wohnfläche (m²)</label>
            <input id="living_space_to" type="number" inputmode="numeric" min="0" />
          </div>
          <div style="margin-bottom:0.65rem;">
            <label for="rooms_to">Anzahl Zimmer</label>
            <input id="rooms_to" type="number" inputmode="numeric" min="0" step="1" />
          </div>
          <div style="margin-bottom:0.8rem;">
            <label for="floor_to">Etage</label>
            <select id="floor_to">
              <option value="">Bitte wählen</option>
              <option value="-1">-1</option>
              <option value="0">EG</option>
              <option value="1">1. OG</option>
              <option value="2">2. OG</option>
              <option value="3">3. OG</option>
              <option value="4">4. OG</option>
              <option value="5">5. OG</option>
              <option value="6">6. OG</option>
              <option value="7">7. OG</option>
              <option value="8">8. OG</option>
              <option value="9">9. OG</option>
              <option value="10">10. OG</option>
              <option value="egal">Egal</option>
            </select>
          </div>

          <div style="display:flex;align-items:center;justify-content:flex-start;gap:0.55rem;">
            <input type="checkbox" id="has_elevator_to" />
            <label for="has_elevator_to" style="margin:0;font-size:0.88rem;cursor:pointer;">Aufzug vorhanden</label>
          </div>
        </div>
      </div>
    </div>

    <!-- STEP 3 -->
    <div class="form-step" data-step="3">
      <h2 class="step-title">Art des Umzugs</h2>
      <p class="step-subtitle">Damit wir passende Angebote finden können.</p>

      <div style="margin-bottom:1.1rem;font-size:0.9rem;font-weight:600;">Privat oder geschäftlich?</div>
      <div class="choice-grid choice-grid-2">
        <div class="choice-card" data-choice-group="move_type" data-choice-value="privat">
          <div class="choice-title">Privatumzug</div>
          <div class="choice-sub">Wohnungswechsel, Hausumzug</div>
        </div>
        <div class="choice-card" data-choice-group="move_type" data-choice-value="geschaeft">
          <div class="choice-title">Geschäftsumzug</div>
          <div class="choice-sub">Büroumzug, Firmensitz</div>
        </div>
      </div>

      <div style="margin:1.1rem 0 0.9rem;font-size:0.9rem;font-weight:600;">Geht der Umzug ins Ausland?</div>
      <div class="choice-grid choice-grid-2">
        <div class="choice-card" data-choice-group="is_international" data-choice-value="false">
          <div class="choice-title">Innerhalb Deutschlands</div>
          <div class="choice-sub">Lokaler oder nationaler Umzug</div>
        </div>
        <div class="choice-card" data-choice-group="is_international" data-choice-value="true">
          <div class="choice-title">Ins Ausland</div>
          <div class="choice-sub">Internationaler Umzug</div>
        </div>
      </div>

      <div style="margin:1.1rem 0 0.9rem;font-size:0.9rem;font-weight:600;">Umfang des Umzugs</div>
      <div class="choice-grid choice-grid-3">
        <div class="choice-card" data-choice-group="move_scope" data-choice-value="ganzer_haushalt">
          <div class="choice-title">Ganzer Haushalt</div>
          <div class="choice-sub">Komplette Wohnung / Haus</div>
        </div>
        <div class="choice-card" data-choice-group="move_scope" data-choice-value="halber_haushalt">
          <div class="choice-title">Halber Haushalt</div>
          <div class="choice-sub">Teilweise Möbel &amp; Kartons</div>
        </div>
        <div class="choice-card" data-choice-group="move_scope" data-choice-value="teilumzug">
          <div class="choice-title">Nur Kartons</div>
          <div class="choice-sub">Wenige Gegenstände</div>
        </div>
      </div>

      <div style="margin-top:1.2rem;">
        <label for="move_notes">Optionale Infos zum Umzug (optional)</label>
        <textarea id="move_notes" placeholder="z.B. empfindliche Möbel, Halteverbotszone, gewünschte Zusatzleistungen …"></textarea>
      </div>

      <div class="error" id="err_step3" style="margin-top:0.4rem;"></div>
    </div>

    <!-- STEP 4 -->
    <div class="form-step" data-step="4">
      <div id="matchingLoading" class="matching-loading">
        <div class="spinner"></div>
        <div>Wir suchen passende Umzugsunternehmen in Ihrer Nähe …</div>
      </div>

      <div id="matchingResult" style="display:none;">
        <h2 class="step-title">Unternehmen in Ihrer Nähe gefunden!</h2>
        <p class="step-subtitle">Wir haben passende Umzugsunternehmen in Ihrer Region identifiziert.</p>

        <div class="matching-circle"><span>✓</span></div>

        <div class="matching-stats">
          <div class="matching-card">
            <div class="matching-num">bis zu 5</div>
            <div class="matching-label">Umzugsfirmen</div>
          </div>
          <div class="matching-card">
            <div class="matching-num">100&nbsp;%</div>
            <div class="matching-label">Geprüft</div>
          </div>
          <div class="matching-card">
            <div class="matching-num">24h</div>
            <div class="matching-label">Antwort</div>
          </div>
        </div>

        <div class="matching-hint">
          Fast geschafft! Nur noch Ihre Kontaktdaten, damit die passenden Unternehmen Sie erreichen können.
        </div>
      </div>
    </div>

    <!-- STEP 5 -->
    <div class="form-step" data-step="5">
      <h2 class="step-title">Ihre Kontaktdaten &amp; Umzugstermin</h2>
      <p class="step-subtitle">Damit die Umzugsfirmen Ihnen passende Angebote zusenden können.</p>

      <div class="grid-2">
        <div>
          <div style="margin-bottom:0.6rem;">
            <label for="customer_name">Ihr Name*</label>
            <input id="customer_name" type="text" />
            <div class="error" id="err_name"></div>
          </div>

          <div style="margin-bottom:0.6rem;">
            <label for="phone">Telefonnummer*</label>
            <!-- +49 erlaubt -->
            <input id="phone" type="tel" inputmode="tel" autocomplete="tel" maxlength="18" />
            <div class="error" id="err_phone"></div>
          </div>

          <div style="margin-bottom:0.6rem;">
            <label for="email">E-Mail-Adresse*</label>
            <input id="email" type="email" autocomplete="email" />
            <div class="error" id="err_email"></div>

            <div class="email-verify-box">
              <strong>Hinweis:</strong> Bitte E-Mail per Link bestätigen – erst dann geben wir Ihre Anfrage weiter.
            </div>
          </div>
        </div>

        <div>
          <div style="margin-bottom:0.6rem;">
            <label for="move_date_type">Umzugstermin*</label>
            <select id="move_date_type">
              <option value="fest">Festes Datum</option>
              <option value="zeitraum">Zeitraum</option>
            </select>
          </div>
          <div id="date_fixed">
            <label for="move_date">Datum*</label>
            <input id="move_date" type="date" />
          </div>
          <div id="date_range" style="display:none;">
            <div style="margin-bottom:0.5rem;">
              <label for="move_date_from">Von*</label>
              <input id="move_date_from" type="date" />
            </div>
            <div>
              <label for="move_date_to">Bis*</label>
              <input id="move_date_to" type="date" />
            </div>
          </div>
          <div class="error" id="err_date" style="margin-top:0.35rem;"></div>
        </div>
      </div>

      <p class="hint" style="margin-top:0.85rem;">
        Mit dem Absenden Ihrer Anfrage stimmen Sie zu, dass ausgewählte Umzugsunternehmen Sie
        telefonisch oder per E-Mail zur Angebotserstellung kontaktieren dürfen.
      </p>
    </div>

    <!-- STEP 6 -->
    <div class="form-step" data-step="6">
      <div class="success-message">
        <div class="success-circle"><span>✓</span></div>
        <h2>Vielen Dank für Ihre Anfrage!</h2>
        <p class="hint">
          Bitte prüfen Sie Ihr E-Mail-Postfach und bestätigen Sie Ihre E-Mail-Adresse über den Link.
        </p>
        <p class="hint" style="margin-top:0.75rem;">
          Datenschutz: Ihre Daten werden ausschließlich zur Vermittlung von Umzugsangeboten verwendet
          und nicht an Dritte weitergegeben.
        </p>
      </div>
    </div>

    <div class="nav-row" id="navRow">
      <button class="btn btn-outline" id="btnBack">Zurück</button>
      <button class="btn btn-primary" id="btnNext">Weiter</button>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <a href="impressum.html">Impressum</a> ·
      <a href="datenschutz.html">Datenschutz</a>
    </div>
  </footer>
</div>

<script>
  const TOTAL_STEPS = 5;
  let currentStep = 1;
  const formData = {};
  let todayStr = null;

  const API_URL = "/api/leads";

  const stepEls = document.querySelectorAll(".form-step");
  const indicatorItems = document.querySelectorAll("#stepIndicator .step-item");
  const btnBack = document.getElementById("btnBack");
  const btnNext = document.getElementById("btnNext");
  const navRow = document.getElementById("navRow");

  const loadingBox = document.getElementById("matchingLoading");
  const resultBox = document.getElementById("matchingResult");

  function initDatesMin() {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    todayStr = today.toISOString().split("T")[0];
    ["move_date", "move_date_from", "move_date_to"].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.min = todayStr;
    });
  }

  function showStep(step) {
    currentStep = step;

    stepEls.forEach(el => el.classList.toggle("active", Number(el.dataset.step) === step));

    indicatorItems.forEach(item => {
      const s = Number(item.dataset.step);
      item.classList.toggle("current", s === step);
      item.classList.toggle("completed", s < step);
    });

    btnBack.disabled = (step === 1);

    if (step === 4) {
      btnNext.style.display = "none";
      runMatchingAnimation();
    } else {
      btnNext.style.display = "inline-flex";
    }

    navRow.style.display = (step === 6) ? "none" : "flex";
    btnNext.textContent = (step === 5) ? "Angebote erhalten" : "Weiter";

    validateStep();
  }

  function collectData() {
    formData.move_from_zip  = (document.getElementById("move_from_zip").value || "").trim();
    formData.move_from_city = (document.getElementById("move_from_city").value || "").trim();
    formData.move_to_zip    = (document.getElementById("move_to_zip").value || "").trim();
    formData.move_to_city   = (document.getElementById("move_to_city").value || "").trim();

    formData.living_space_from = document.getElementById("living_space_from").value;
    formData.rooms_from        = document.getElementById("rooms_from").value;
    formData.floor_from        = document.getElementById("floor_from").value;
    formData.has_elevator_from = document.getElementById("has_elevator_from").checked;

    formData.living_space_to = document.getElementById("living_space_to").value;
    formData.rooms_to        = document.getElementById("rooms_to").value;
    formData.floor_to        = document.getElementById("floor_to").value;
    formData.has_elevator_to = document.getElementById("has_elevator_to").checked;

    const notesEl = document.getElementById("move_notes");
    formData.move_notes = notesEl ? notesEl.value.trim() : "";

    formData.customer_name  = (document.getElementById("customer_name").value || "").trim();
    formData.phone          = (document.getElementById("phone").value || "").trim();
    formData.email          = (document.getElementById("email").value || "").trim();
    formData.move_date_type = document.getElementById("move_date_type").value;
    formData.move_date      = document.getElementById("move_date").value;
    formData.move_date_from = document.getElementById("move_date_from").value;
    formData.move_date_to   = document.getElementById("move_date_to").value;
  }

  function clearErrors() {
    document.querySelectorAll(".error").forEach(e => (e.textContent = ""));
  }

  function validateStep() {
    clearErrors();
    collectData();
    let valid = true;

    const onlyDigits5 = (v) => /^\d{5}$/.test(v);

    if (currentStep === 1) {
      if (!onlyDigits5(formData.move_from_zip)) {
        const el = document.getElementById("err_from_zip");
        if (el) el.textContent = "Bitte gültige Postleitzahl eingeben (5 Ziffern).";
        valid = false;
      }
      if (!onlyDigits5(formData.move_to_zip)) {
        const el = document.getElementById("err_to_zip");
        if (el) el.textContent = "Bitte gültige Postleitzahl eingeben (5 Ziffern).";
        valid = false;
      }
    }

    if (currentStep === 3) {
      if (!formData.move_type || typeof formData.is_international === "undefined" || !formData.move_scope) {
        const el = document.getElementById("err_step3");
        if (el) el.textContent = "Bitte wählen Sie jeweils eine Option aus allen Bereichen.";
        valid = false;
      }
    }

    if (currentStep === 5) {
      if (!formData.customer_name) {
        const el = document.getElementById("err_name");
        if (el) el.textContent = "Bitte Namen eingeben.";
        valid = false;
      }

      // Telefon: erlaubt + am Anfang, danach Ziffern. Länge 7–15 Ziffern (ohne +)
      const raw = formData.phone || "";
      const cleaned = raw
        .replace(/\s+/g, "")
        .replace(/\(0\)/g, "")
        .replace(/^00/, "+"); // 0049 -> +49

      const isValidPattern = /^\+?\d+$/.test(cleaned);
      const digitsOnly = cleaned.replace(/\D/g, "");

      if (!cleaned) {
        const el = document.getElementById("err_phone");
        if (el) el.textContent = "Bitte Telefonnummer eingeben.";
        valid = false;
      } else if (!isValidPattern) {
        const el = document.getElementById("err_phone");
        if (el) el.textContent = "Bitte nur Zahlen (optional mit +49).";
        valid = false;
      } else if (digitsOnly.length < 7 || digitsOnly.length > 15) {
        const el = document.getElementById("err_phone");
        if (el) el.textContent = "Bitte gültige Telefonnummer eingeben.";
        valid = false;
      }

      if (!formData.email) {
        const el = document.getElementById("err_email");
        if (el) el.textContent = "Bitte E-Mail eingeben.";
        valid = false;
      }

      let hasDate = false;
      if (formData.move_date_type === "fest") {
        hasDate = !!formData.move_date;
      } else {
        hasDate = !!formData.move_date_from && !!formData.move_date_to && formData.move_date_from <= formData.move_date_to;
      }

      if (!hasDate) {
        const el = document.getElementById("err_date");
        if (el) el.textContent = "Bitte gültigen Umzugstermin angeben.";
        valid = false;
      }
    }

    if (currentStep !== 4) btnNext.disabled = !valid;
    return valid;
  }

  // Choice Cards
  document.querySelectorAll(".choice-card").forEach(card => {
    card.addEventListener("click", () => {
      const group = card.dataset.choiceGroup;
      const value = card.dataset.choiceValue;

      document.querySelectorAll(`.choice-card[data-choice-group="${group}"]`).forEach(c => c.classList.remove("selected"));
      card.classList.add("selected");

      if (group === "is_international") formData.is_international = (value === "true");
      else formData[group] = value;

      validateStep();
    });
  });

  // Date switch
  const dateTypeSelect = document.getElementById("move_date_type");
  const dateFixed = document.getElementById("date_fixed");
  const dateRange = document.getElementById("date_range");
  dateTypeSelect.addEventListener("change", () => {
    if (dateTypeSelect.value === "fest") { dateFixed.style.display = "block"; dateRange.style.display = "none"; }
    else { dateFixed.style.display = "none"; dateRange.style.display = "block"; }
    validateStep();
  });

  // Live validation
  document.querySelectorAll("input,select,textarea").forEach(el => {
    el.addEventListener("input", () => {
      if (currentStep === 1 || currentStep === 5) validateStep();
    });
  });

  // PLZ: nur Zahlen
  const z1 = document.getElementById("move_from_zip");
  const z2 = document.getElementById("move_to_zip");
  [z1, z2].forEach(z => {
    z.addEventListener("input", () => {
      const digits = z.value.replace(/\D/g, "");
      z.value = digits.slice(0, 5);
      if (currentStep === 1) validateStep();
    });
  });

  // Telefon: erlaubt + am Anfang, sonst nur Zahlen
  const phoneInput = document.getElementById("phone");
  phoneInput.addEventListener("input", () => {
    let v = phoneInput.value || "";
    // entferne alles außer Ziffern und +
    v = v.replace(/[^\d+]/g, "");
    // nur ein + und nur am Anfang
    if (v.includes("+")) {
      v = (v.startsWith("+") ? "+" : "") + v.replace(/\+/g, "");
    }
    // maxlength & sanity
    phoneInput.value = v.slice(0, 18);
    if (currentStep === 5) validateStep();
  });

  // Back
  btnBack.addEventListener("click", () => {
    if (currentStep > 1) showStep(currentStep - 1);
  });

  function buildPayloadForApi() {
    // normalize phone for backend: 0049 -> +49, remove spaces, keep + and digits
    let p = (formData.phone || "").replace(/\s+/g, "").replace(/\(0\)/g, "").replace(/^00/, "+");
    p = p.replace(/[^\d+]/g, "");
    if (p.includes("+")) p = (p.startsWith("+") ? "+" : "") + p.replace(/\+/g, "");

    return {
      move_from_zip: formData.move_from_zip || null,
      move_from_city: formData.move_from_city || null,
      move_to_zip: formData.move_to_zip || null,
      move_to_city: formData.move_to_city || null,

      living_space_from: formData.living_space_from || null,
      rooms_from: formData.rooms_from || null,
      floor_from: formData.floor_from || null,
      has_elevator_from: formData.has_elevator_from ? 1 : 0,

      living_space_to: formData.living_space_to || null,
      rooms_to: formData.rooms_to || null,
      floor_to: formData.floor_to || null,
      has_elevator_to: formData.has_elevator_to ? 1 : 0,

      move_notes: formData.move_notes || null,
      move_type: formData.move_type || null,
      is_international: (typeof formData.is_international === "boolean") ? formData.is_international : null,
      move_scope: formData.move_scope || null,

      customer_name: formData.customer_name || null,
      phone: p || null,
      email: formData.email || null,

      move_date_type: formData.move_date_type || null,
      move_date: formData.move_date || null,
      move_date_from: formData.move_date_from || null,
      move_date_to: formData.move_date_to || null,

      email_verification_required: true
    };
  }

  btnNext.addEventListener("click", async () => {
    if (!validateStep()) return;

    if (currentStep < TOTAL_STEPS) {
      showStep(currentStep + 1);
      return;
    }

    collectData();
    const payload = buildPayloadForApi();

    btnNext.disabled = true;
    btnNext.textContent = "Senden…";
    btnBack.disabled = true;

    try{
      const response = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json", "Accept": "application/json" },
        body: JSON.stringify(payload)
      });

      await response.json().catch(() => ({}));
      document.querySelector("main.card").scrollIntoView({ behavior: "smooth" });
      showStep(6);
    } catch(err){
      console.log("API nicht erreichbar (noch nicht online):", err);
      document.querySelector("main.card").scrollIntoView({ behavior: "smooth" });
      showStep(6);
    } finally {
      btnNext.disabled = false;
      btnBack.disabled = false;
      btnNext.textContent = "Angebote erhalten";
    }
  });

  function runMatchingAnimation() {
    if (!loadingBox || !resultBox) return;
    loadingBox.style.display = "block";
    resultBox.style.display = "none";

    setTimeout(() => { loadingBox.style.display = "none"; resultBox.style.display = "block"; }, 2000);
    setTimeout(() => { if (currentStep === 4) showStep(5); }, 4000);
  }

  initDatesMin();
  validateStep();
</script>
</body>
</html>
